<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorator="~{layout/layout_for_exam}">
<th:block layout:fragment="content">
    <style>

        .right-bar {
            right: 0px;
            top: 0px;
            bottom: 0px;
            width: 400px;
            height: 100vmax;
            z-index: 99;
            position: fixed;
            display: block;
            background-color: #fff;
        }

        .wrap {
            width: 500px;
            display: grid;
            grid-template-columns: repeat(5, 1fr);
        }

        .wrap-exam {
            width : 1200px;
            justify-content: left;
            display: grid;
            grid-template-columns: repeat(2, 1fr);
        }

    </style>
    <div class="right-bar">
        <h3 style="text-align: center; display: inline">현재 시간 : </h3>
        <h3 class = "h3-clock" style="text-align: center; display: inline"></h3>
        <div class="card-body animate-chk">
            <div class="row">
                <div class="wrap">
                    <label class="d-block"th:each="examNumber : ${examList}" th:for="${mberNo + ':' + examNumber.examNumber}" >
                        <input class="checkbox_animated" th:id="${mberNo + ':' + examNumber.examSn}" type="checkbox" disabled>
                        <span th:text="${examNumber.examNumber}"></span>
                    </label>
                </div>
                <br>
                <button class="btn btn-primary float-end submission" type="button">제출</button>
            </div>
        </div>
    </div>
    <div class="container-fluid">
        <div class="container">
            <div class="row no-gutters">
                <div class="bg-secondary wrap-exam">
                    <div th:each="list : ${examList}" th:id="${list.examSn}" class="question bg-primary" style="margin: 5px">
                        <div class="py-2 h4">
                            <b th:text="${list.examNumber+'. '}"></b>
                            <b th:text="${list.examTitle}"></b>
                        </div>
                        <div class="ml-md-3 ml-sm-3 pl-md-5 pt-sm-0 pt-3" th:id="${list.examSn + ':' + list.examNumber}"
                             th:if="${list.examType.equals('subjective')}">
                            <div class="input-group">
                                <span class="input-group-text btn btn-danger">정답</span>
                                <input th:id="${list.examSn + 'answer'}" class="form-control btn-square" placeholder="입력" type="text">
                            </div>
                        </div>
                        <div class="ml-md-3 ml-sm-3 pl-md-5 pt-sm-0 pt-3" th:if="${list.examType.equals('objective')}">
                            <label th:each="num : ${#numbers.sequence(1,4)}" style="display: block">
                                <b th:text="${num + '. ' + examContentMap.get(list.examSn+num)}"/>
                            </label>
                            <div class="input-group">
                                <span class="input-group-text btn btn-danger">prepend</span>
                                <input th:id="${list.examSn + 'answer'}" class="form-control btn-square" placeholder="번호 입력" type="text">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    </div>
    <script th:inline="javascript">
        /*<![CDATA[*/
        const examList = /*[[ ${examList} ]]*/;
        const mberNo = /*[[ ${mberNo} ]]*/;
        const examInfoTimelimit = /*[[ ${examInfoTimelimit} ]]*/;
        /*]]*/
        const container = document.querySelector('.container')
        const clock = document.querySelector('.h3-clock');

        var time = examInfoTimelimit * 60; //기준시간 작성
        var min = ""; //분
        var sec = ""; //초

        //setInterval(함수, 시간) : 주기적인 실행
        var x = setInterval(function() {
            //parseInt() : 정수를 반환
            min = parseInt(time/60); //몫을 계산
            sec = time%60; //나머지를 계산

            clock.innerHTML = min + "분" + sec + "초";
            time--;

            //타임아웃 시
            if (time < 0) {
                clearInterval(x); //setInterval() 실행을 끝냄
                clock.innerHTML = "시간초과";
            }
        }, 1000);

        window.addEventListener('keypress', function (event) {
            if(event.keyCode === 9 && event.altKey) {
                alert('you pressed SHIFT+A');
            }
        })

        document.addEventListener("visibilitychange", e => {
            console.log(e)
        })

        window.addEventListener('mouseout', function (event) {
            // console.log(event.target)
            // console.log(event.relatedTarget)
            if(event.relatedTarget == null) {
                // alert("경고")
            }
        })

        container.addEventListener('keyup', function (event) {
            for (var i = 0; i <=20; i++) {
                let inputAnswerId = examList[i].examSn+'answer';
                let inputAnswerRadio = mberNo+':'+examList[i].examSn;

                let answerId = document.getElementById(inputAnswerId)
                let answerRadio = document.getElementById(inputAnswerRadio)

                console.log(answerId.value)
                console.log(answerRadio)

                if(answerId.value != 0) {
                    answerRadio.setAttribute('checked', 'checked')
                } else if (answerId.value == 0) {
                    answerRadio.removeAttribute('checked')
                }
            }
        })

        //특정 키값 입력 방지
        // window.addEventListener('keydown', function (event) {
        //     //tab 9, alt 18, ctrl 17, f1~12 112~123
        //
        //     if (event.altKey) {
        //        event.preventDefault()
        //        event.returnValue = false
        //     } else if(event.ctrlKey) {
        //        event.preventDefault()
        //        event.returnValue = false
        //     } else if(event.keyCode === 9) {
        //        event.preventDefault()
        //        event.returnValue = false
        //     } else if (event.altKey && event.keyCode==9) {
        //        event.preventDefault()
        //        event.returnValue = false
        //     }
        //     else if(event.keyCode >= 112 && event.keyCode <= 122) {
        //         event.preventDefault()
        //          event.returnValue = false
        //     }
        //
        //     console.log(event.keyCode)
        // })

        //우클릭 방지
        document.onmousedown=disableclick;
        status = "우클릭 금지";

        function disableclick(event) {
            if(event.button==2) {
                alert(status)
                return false
            }
        }
    </script>
</th:block>
</html>